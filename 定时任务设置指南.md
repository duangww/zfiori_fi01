# Windows 11 定时任务设置指南

## 方法一：使用 PowerShell 脚本（推荐）

1. **运行设置脚本**
   ```powershell
   # 以管理员身份运行 PowerShell
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
   .\setup_scheduled_task.ps1
   ```

## 方法二：手动设置

### 1. 打开任务计划程序
- 按 `Win + R`，输入 `taskschd.msc`
- 或者搜索"任务计划程序"

### 2. 创建基本任务
1. 在右侧面板点击"创建基本任务"
2. 任务名称：`WeekPushWxTask`
3. 描述：`每周推送微信消息任务`

### 3. 设置触发器
1. 选择"每周"
2. 设置开始时间：`11:00:00`
3. 选择"星期一"
4. 点击"下一步"

### 4. 设置操作
1. 选择"启动程序"
2. 程序或脚本：`node`
3. 添加参数：`C:\Users\bak\projects\zauto\1100WeekPushWx.js`
4. 起始于：`C:\Users\bak\projects\zauto`

### 5. 完成设置
1. 勾选"当单击完成时，打开此任务属性的对话框"
2. 点击"完成"

### 6. 高级设置
在属性对话框中：
1. **常规**选项卡：
   - 勾选"使用最高权限运行"
   - 选择"不管用户是否登录都要运行"

2. **条件**选项卡：
   - 勾选"只有在计算机使用交流电源时才启动此任务"
   - 勾选"如果计算机切换到电池电源，则停止"

3. **设置**选项卡：
   - 勾选"允许按需运行任务"
   - 勾选"如果任务运行时间超过以下时间，则停止任务"（设置 30 分钟）

## 验证设置

### 1. 检查任务状态
```powershell
Get-ScheduledTask -TaskName "WeekPushWxTask"
```

### 2. 手动测试运行
```powershell
Start-ScheduledTask -TaskName "WeekPushWxTask"
```

### 3. 查看任务历史
在任务计划程序中：
1. 找到 `WeekPushWxTask`
2. 右键选择"查看历史记录"

## 常用管理命令

```powershell
# 启动任务
Start-ScheduledTask -TaskName "WeekPushWxTask"

# 停止任务
Stop-ScheduledTask -TaskName "WeekPushWxTask"

# 删除任务
Unregister-ScheduledTask -TaskName "WeekPushWxTask"

# 查看任务详情
Get-ScheduledTask -TaskName "WeekPushWxTask" | Format-List

# 查看所有任务
Get-ScheduledTask | Where-Object {$_.TaskName -like "*WeekPush*"}
```

## 故障排除

### 1. 脚本无法运行
- 检查 Node.js 是否正确安装
- 确认脚本路径是否正确
- 检查脚本是否有执行权限

### 2. 任务不执行
- 检查任务计划程序服务是否运行
- 确认用户账户有足够权限
- 查看任务历史记录中的错误信息

### 3. 权限问题
- 以管理员身份运行 PowerShell
- 确保用户账户有执行权限

## 注意事项

1. **路径格式**：使用绝对路径，避免相对路径
2. **工作目录**：确保设置正确的工作目录
3. **权限**：任务需要足够的权限来访问脚本和依赖
4. **日志**：建议在脚本中添加日志记录
5. **测试**：设置完成后先手动测试运行

## 修改执行时间

如果需要修改执行时间，可以：
1. 在任务计划程序中编辑任务
2. 或者删除任务后重新创建
3. 或者使用 PowerShell 命令修改触发器 